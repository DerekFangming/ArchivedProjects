<?xml version="1.0" encoding="utf-8"?>

<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" width="362" height="330"
	     xmlns:esri="http://www.esri.com/2008/ags">
	<fx:Script>
		<![CDATA[
			import com.esri.ags.geometry.Extent;
			import com.esri.ags.geometry.MapPoint;
			import com.esri.ags.Graphic;
			import com.esri.ags.events.FindEvent;
			import com.esri.ags.geometry.Extent;
			import com.esri.ags.tasks.supportClasses.FindResult;
			import com.esri.ags.utils.GraphicUtil;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			//_pts为在graphics Layer上的点(graphic)构成的array
			private function pointSelect(pnt:MapPoint): Array
			{
				var extent:Extent = new Extent(pnt.x-0.01,pnt.y-0.01,pnt.x+0.01,pnt.y+0.01);
				var res: Array= new Array ();
				
				for each (var grap:Object in myGraphicsLayer)
				{
					
					var mp:MapPoint = grap.geometry as MapPoint;
					if(extent.xmin<=mp.x &&extent.ymin <= mp.y && mp.x <=extent.xmax && mp.y <= extent.ymax)
					{
						res.push(grap);
						
					}
				}
				return res;
							}
			//执行查询
			private function doFind():void
			{
				findTask.execute(myFindParams);
			}

			//查询完毕
			private function executeCompleteHandler(event:FindEvent):void
			{
				myGraphicsLayer.clear();
				
				resultSummary.text = "Found " + event.findResults.length + " results.";
				myGraphicsLayer.symbol = sfsFind;
				
				var resultCount:int = event.findResults.length;
				
				if (resultCount == 0)
				{
					Alert.show("No states found. Please change your search.");
				}
				else
				{
					// add feature as graphic to graphics layer
					for (var i:int = 0; i < resultCount; i++)
					{
						var graphic:Graphic = FindResult(event.findResults[i]).feature;
						graphic.toolTip = event.findResults[i].foundFieldName + ": " + event.findResults[i].value;
						myGraphicsLayer.add(graphic);
					}
					
					// zoom to extent of all features
					var graphicProvider:ArrayCollection = myGraphicsLayer.graphicProvider as ArrayCollection;
					var graphicsExtent:Extent = GraphicUtil.getGraphicsExtent(graphicProvider.toArray());
					map.extent = graphicsExtent.expand(1.4); // zoom out a little
				}
			}
			
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<esri:SimpleFillSymbol id="sfsFind" alpha="0.7"/>
		
		<!-- Find Task 查询任务-->
		<esri:FindTask id="findTask"
					   executeComplete="executeCompleteHandler(event)"
					   url="http://sampleserver6.arcgisonline.com/arcgis/rest/services/Census/MapServer"/>
		
		<esri:FindParameters id="myFindParams"
							 contains="true"
							 layerIds="[3]"
							 outSpatialReference="{map.spatialReference}"
							 returnGeometry="true"
							 searchFields="[STATE_ABBR,STATE_NAME]"
							 searchText="New York"
							 
							 />
	</fx:Declarations>

	<esri:Map level="3" wrapAround180="true" id="map">
		<esri:center>
			<esri:WebMercatorMapPoint lon="0" lat="0" />
		</esri:center>
		<esri:ArcGISTiledMapServiceLayer 
			url="http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"/>	
		<esri:GraphicsLayer id="myGraphicsLayer"/>
	</esri:Map>
	<s:Label id="resultSummary" height="15"/>
	<s:Button x="317" y="10" width="51" height="25" label="Find" click="doFind()"/>
</s:Group>